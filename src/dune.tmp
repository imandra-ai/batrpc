
(library
  (name imandrax_bin_rpc)
  (public_name imandrax.bin-rpc)
  (synopsis "Binary RPC over streams of bytes for protobuf services.")
  (flags :standard -open Imandrax_util -open Imandrax_util_thread)
  (preprocess (pps ppx_deriving.std))
  (libraries imandrax.util imandrax.util.thread pbrt pbrt_services unix))

(rule
  (targets meta.ml meta.mli)
  (deps (:file meta.proto))
  (mode promote)
  (action (run ocaml-protoc --ml_out=. --services --binary --yojson --pp --make %{file})))
