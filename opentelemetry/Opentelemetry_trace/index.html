<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Opentelemetry_trace (opentelemetry.Opentelemetry_trace)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">opentelemetry</a> &#x00BB; Opentelemetry_trace</nav><header class="odoc-preamble"><h1>Module <code><span>Opentelemetry_trace</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#wellknown">Well-known identifiers</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec module-substitution anchored" id="module-Otel"><a href="#module-Otel" class="anchor"></a><code><span><span class="keyword">module</span> Otel := <a href="../Opentelemetry/index.html">Opentelemetry</a></span></code></div></div><div class="odoc-spec"><div class="spec module-substitution anchored" id="module-Otrace"><a href="#module-Otrace" class="anchor"></a><code><span><span class="keyword">module</span> Otrace := <a href="../../trace/Trace_core/index.html">Trace_core</a></span></code></div></div><div class="odoc-spec"><div class="spec module-substitution anchored" id="module-TLS"><a href="#module-TLS" class="anchor"></a><code><span><span class="keyword">module</span> TLS := <a href="../../ambient-context/Ambient_context_thread_local/Thread_local/index.html">Ambient_context_tls.TLS</a></span></code></div></div><p><code>opentelemetry.trace</code> implements a <a href="../../trace/Trace_core/Collector/index.html"><code>Trace_core.Collector</code></a> for <a href="https://v3.ocaml.org/p/trace">ocaml-trace</a>.</p><p>After installing this collector with <a href="#val-setup"><code>setup</code></a>, you can consume libraries that use <code>ocaml-trace</code>, and they will automatically emit OpenTelemetry spans and logs.</p><p>Both explicit scope (in the <code>_manual</code> functions such as <code>enter_manual_span</code>) and implicit scope (in <code>Internal.M.with_span</code>, via <a href="../../ambient-context/Ambient_context/index.html"><code>Ambient_context</code></a>) are supported; see the detailed notes on <code>Internal.M.enter_manual_span</code>.</p><h2 id="wellknown"><a href="#wellknown" class="anchor"></a>Well-known identifiers</h2><p>Because <code>ocaml-trace</code>'s API is a subset of OpenTelemetry functionality, this interface allows for a few 'well-known' identifiers to be used in <code>Trace</code>-instrumented libraries that wish to further support OpenTelemetry usage.</p><p>(These strings will not change in subsequent versions of this library, so you do not need to depend on <code>opentelemetry.trace</code> to use them.)</p><ul><li>If a key of exactly <code>&quot;otrace.spankind&quot;</code> is included in the <a href="../../trace/Trace_core/index.html#type-user_data"><code>Trace_core.user_data</code></a> passed to <code>with_span</code> et al., it will be used as the <a href="../Opentelemetry/Span/index.html#type-kind"><code>Opentelemetry.Span.kind</code></a> of the emitted span. (See <code>Internal.spankind_of_string</code> for the list of supported values.)</li></ul><pre class="language-ocaml"><code>ocaml
let describe () = [ Opentelemetry_trace.(spankind_key, client) ] in
Trace_core.with_span ~__FILE__ ~__LINE__ ~data:describe &quot;my-span&quot;
@@ fun _ -&gt;
  (* ... *)</code></pre><div class="odoc-spec"><div class="spec value anchored" id="val-on_internal_error"><a href="#val-on_internal_error" class="anchor"></a><code><span><span class="keyword">val</span> on_internal_error : <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> unit)</span> <a href="../../ocaml/Stdlib/index.html#type-ref">ref</a></span></span></code></div><div class="spec-doc"><p>Callback to print errors in the library itself (ie bugs)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setup"><a href="#val-setup" class="anchor"></a><code><span><span class="keyword">val</span> setup : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Install the OTEL backend as a Trace collector</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setup_with_otel_backend"><a href="#val-setup_with_otel_backend" class="anchor"></a><code><span><span class="keyword">val</span> setup_with_otel_backend : <span><a href="../Opentelemetry/Collector/index.html#type-backend">Opentelemetry.Collector.backend</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Same as <a href="#val-setup"><code>setup</code></a>, but also install the given backend as OTEL backend</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-collector"><a href="#val-collector" class="anchor"></a><code><span><span class="keyword">val</span> collector : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="../../trace/Trace_core/index.html#type-collector">Trace_core.collector</a></span></code></div><div class="spec-doc"><p>Make a Trace collector that uses the OTEL backend to send spans and logs</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Well_known"><a href="#module-Well_known" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Well_known/index.html">Well_known</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Static references for well-known identifiers; see <a href="#wellknown" title="wellknown">Well-known identifiers</a>.</p></div></div></div></body></html>
