<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Framing (batrpc.Batrpc_core.Framing)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">batrpc</a> &#x00BB; <a href="../index.html">Batrpc_core</a> &#x00BB; Framing</nav><header class="odoc-preamble"><h1>Module <code><span>Batrpc_core.Framing</span></code></h1><p>Framing.</p><p>This part of the library is concerned with framing, ie. how we parse and separate messages on the wire. We work over streams of bytes so we need to know where each message starts and ends.</p><p>To do so, each message starts with a <code>u16</code> in little endian. It indicates how many bytes the following <code>Meta.meta</code> message takes. The <code>Meta.meta</code> message provides information about the given RPC message (id, method, etc.) as well as the size in bytes of the <code>body</code>, ie. the main protobuf object passed as argument (or reply) to the remote method.</p><p>Framing also handles compression automatically.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-config"><a href="#type-config" class="anchor"></a><code><span><span class="keyword">type</span> config</span><span> = </span><span>{</span></code><ol><li id="type-config.use_zlib" class="def record field anchored"><a href="#type-config.use_zlib" class="anchor"></a><code><span>use_zlib : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Use zlib compression on large messages?</p><span class="comment-delim">*)</span></div></li><li id="type-config.zlib_compression_threshold_B" class="def record field anchored"><a href="#type-config.zlib_compression_threshold_B" class="anchor"></a><code><span>zlib_compression_threshold_B : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Size of body above which we apply zlib compression.</p><span class="comment-delim">*)</span></div></li><li id="type-config.buf_pool" class="def record field anchored"><a href="#type-config.buf_pool" class="anchor"></a><code><span>buf_pool : <a href="../Buf_pool/index.html#type-t">Buf_pool.t</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Configuration for framing in general</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make_config"><a href="#val-make_config" class="anchor"></a><code><span><span class="keyword">val</span> make_config : 
  <span><span class="label">use_zlib</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?zlib_compression_threshold_B</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">buf_pool</span>:<a href="../Buf_pool/index.html#type-t">Buf_pool.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-config">config</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_config"><a href="#val-pp_config" class="anchor"></a><code><span><span class="keyword">val</span> pp_config : 
  <span><a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Ppx_deriving_runtime.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../ppx_deriving/Ppx_deriving_runtime/index.html#type-unit">Ppx_deriving_runtime.unit</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-show_config"><a href="#val-show_config" class="anchor"></a><code><span><span class="keyword">val</span> show_config : <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../ppx_deriving/Ppx_deriving_runtime/index.html#type-string">Ppx_deriving_runtime.string</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_config"><a href="#val-default_config" class="anchor"></a><code><span><span class="keyword">val</span> default_config : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_meta"><a href="#val-read_meta" class="anchor"></a><code><span><span class="keyword">val</span> read_meta : 
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/In/class-type-t/index.html">Io.In.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Meta/index.html#type-meta">Meta.meta</a> option</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_body_req"><a href="#val-read_body_req" class="anchor"></a><code><span><span class="keyword">val</span> read_body_req : 
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/In/class-type-t/index.html">Io.In.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">meta</span>:<a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'req</span>, <span class="type-var">_</span>, <span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="../../../pbrt_services/Pbrt_services/Server/index.html#type-rpc">Pbrt_services.Server.rpc</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'req</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_body_res"><a href="#val-read_body_res" class="anchor"></a><code><span><span class="keyword">val</span> read_body_res : 
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/In/class-type-t/index.html">Io.In.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">meta</span>:<a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>, <span class="type-var">'res</span>, <span class="type-var">_</span>)</span> <a href="../../../pbrt_services/Pbrt_services/Client/index.html#type-rpc">Pbrt_services.Client.rpc</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'res</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_and_discard"><a href="#val-read_and_discard" class="anchor"></a><code><span><span class="keyword">val</span> read_and_discard : 
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/In/class-type-t/index.html">Io.In.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">meta</span>:<a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Read message body but do not decode it. This is useful if we know we need to ignore it (e.g. reply to a request that timed out) but still need to remove bytes from the socket.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_error"><a href="#val-read_error" class="anchor"></a><code><span><span class="keyword">val</span> read_error : 
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/In/class-type-t/index.html">Io.In.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">meta</span>:<a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../Meta/index.html#type-error">Meta.error</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_empty"><a href="#val-read_empty" class="anchor"></a><code><span><span class="keyword">val</span> read_empty : 
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/In/class-type-t/index.html">Io.In.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">meta</span>:<a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_req"><a href="#val-write_req" class="anchor"></a><code><span><span class="keyword">val</span> write_req : 
  <span><span class="optlabel">?enc</span>:<a href="../../../pbrt/Pbrt/Encoder/index.html#type-t">Pbrt.Encoder.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/Out/class-type-t/index.html">Io.Out.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'req</span>, <span class="type-var">_</span>, <span class="type-var">_</span>, <span class="type-var">_</span>)</span> <a href="../../../pbrt_services/Pbrt_services/Client/index.html#type-rpc">Pbrt_services.Client.rpc</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'req</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_error"><a href="#val-write_error" class="anchor"></a><code><span><span class="keyword">val</span> write_error : 
  <span><span class="optlabel">?enc</span>:<a href="../../../pbrt/Pbrt/Encoder/index.html#type-t">Pbrt.Encoder.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/Out/class-type-t/index.html">Io.Out.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Meta/index.html#type-error">Meta.error</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_empty"><a href="#val-write_empty" class="anchor"></a><code><span><span class="keyword">val</span> write_empty : 
  <span><span class="optlabel">?enc</span>:<a href="../../../pbrt/Pbrt/Encoder/index.html#type-t">Pbrt.Encoder.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/Out/class-type-t/index.html">Io.Out.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_res"><a href="#val-write_res" class="anchor"></a><code><span><span class="keyword">val</span> write_res : 
  <span><span class="optlabel">?enc</span>:<a href="../../../pbrt/Pbrt/Encoder/index.html#type-t">Pbrt.Encoder.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Io/Out/class-type-t/index.html">Io.Out.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">config</span>:<a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">encoding</span>:<a href="../Encoding/index.html#type-t">Encoding.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">_</span>, <span class="type-var">_</span>, <span class="type-var">'res</span>, <span class="type-var">_</span>)</span> <a href="../../../pbrt_services/Pbrt_services/Server/index.html#type-rpc">Pbrt_services.Server.rpc</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Meta/index.html#type-meta">Meta.meta</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'res</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div></div></body></html>
